# Tennessee Golf Courses - Professional Clean URLs
RewriteEngine On

# Fix any .tld redirects - redirect to proper .com domain
RewriteCond %{HTTP_HOST} ^(www\.)?tennesseegolfcourses\.tld$ [NC]
RewriteRule ^(.*)$ https://tennesseegolfcourses.com/$1 [R=301,L]

# Handle www subdomain - redirect to non-www
RewriteCond %{HTTP_HOST} ^www\.tennesseegolfcourses\.com$ [NC]
RewriteRule ^(.*)$ https://tennesseegolfcourses.com/$1 [R=301,L]

# Force HTTPS for the main domain
RewriteCond %{HTTPS} off
RewriteCond %{HTTP_HOST} ^tennesseegolfcourses\.com$ [NC]
RewriteRule ^(.*)$ https://tennesseegolfcourses.com/$1 [R=301,L]

# Catch-all for any other domain variations
RewriteCond %{HTTP_HOST} !^tennesseegolfcourses\.com$ [NC]
RewriteCond %{HTTP_HOST} !^$
RewriteRule ^(.*)$ https://tennesseegolfcourses.com/$1 [R=301,L]

# Security: Prevent access to sensitive files
<FilesMatch "\.(env|git|gitignore|sql|log|md|sh|yml|yaml|json|lock)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Prevent directory browsing
Options -Indexes

# Disable server signature
ServerSignature Off

# Prevent access to .htaccess itself
<Files .htaccess>
    Order allow,deny
    Deny from all
</Files>


# Remove .php extension from URLs (external redirect)
RewriteCond %{THE_REQUEST} /([^.]+)\.php [NC]
RewriteRule ^ /%1 [NC,L,R=301]

# Handle specific pages that conflict with directories
RewriteRule ^courses/?$ courses.php [L]
RewriteRule ^news/?$ news.php [L]
RewriteRule ^events/?$ events.php [L]
RewriteRule ^about/?$ about.php [L]
RewriteRule ^contact/?$ contact.php [L]
RewriteRule ^reviews/?$ reviews.php [L]
RewriteRule ^privacy-policy/?$ privacy-policy.php [L]
RewriteRule ^terms-of-service/?$ terms-of-service.php [L]
RewriteRule ^search-courses.php$ search-courses.php [L]

RewriteRule ^community/?$ community.php [L]
RewriteRule ^contests/?$ contests.php [L]
RewriteRule ^contests-submit/?$ contests-submit.php [L]
RewriteRule ^media/?$ media.php [L]
RewriteRule ^maps/?$ maps.php [L]

# Handle course pages (in subdirectory - alphabetical order)
RewriteRule ^courses/bear-trace-harrison-bay/?$ courses/bear-trace-harrison-bay.php [L]
RewriteRule ^courses/avalon-golf-country-club/?$ courses/avalon-golf-country-club.php [L]
RewriteRule ^courses/belle-acres-golf-course/?$ courses/belle-acres-golf-course.php [L]
RewriteRule ^courses/belle-meade-country-club/?$ courses/belle-meade-country-club.php [L]
RewriteRule ^courses/bluegrass-yacht-country-club/?$ courses/bluegrass-yacht-country-club.php [L]
RewriteRule ^courses/big-creek-golf-club/?$ courses/big-creek-golf-club.php [L]
RewriteRule ^courses/brainerd-golf-course/?$ courses/brainerd-golf-course.php [L]
RewriteRule ^courses/brown-acres-golf-course/?$ courses/brown-acres-golf-course.php [L]
RewriteRule ^courses/cedar-crest-golf-club/?$ courses/cedar-crest-golf-club.php [L]
RewriteRule ^courses/cumberland-cove-golf-course/?$ courses/cumberland-cove-golf-course.php [L]
RewriteRule ^courses/cherokee-country-club/?$ courses/cherokee-country-club.php [L]
RewriteRule ^courses/chattanooga-golf-country-club/?$ courses/chattanooga-golf-country-club.php [L]
RewriteRule ^courses/chickasaw-golf-course/?$ courses/chickasaw-golf-course.php [L]
RewriteRule ^courses/chickasaw-country-club/?$ courses/chickasaw-country-club.php [L]
RewriteRule ^courses/council-fire-golf-club/?$ courses/council-fire-golf-club.php [L]
RewriteRule ^courses/cheekwood-golf-club/?$ courses/cheekwood-golf-club.php [L]
RewriteRule ^courses/cheekwood-golf-club-test/?$ courses/cheekwood-golf-club-test.php [L]
RewriteRule ^courses/clarksville-country-club/?$ courses/clarksville-country-club.php [L]
RewriteRule ^courses/colonial-country-club/?$ courses/colonial-country-club.php [L]
RewriteRule ^courses/gaylord-springs-golf-links/?$ courses/gaylord-springs-golf-links.php [L]
RewriteRule ^courses/forrest-crossing-golf-course/?$ courses/forrest-crossing-golf-course.php [L]
RewriteRule ^courses/fox-den-country-club/?$ courses/fox-den-country-club.php [L]
RewriteRule ^courses/greystone-golf-course/?$ courses/greystone-golf-course.php [L]
RewriteRule ^courses/harpeth-hills-golf-course/?$ courses/harpeth-hills-golf-course.php [L]
RewriteRule ^courses/henry-horton-state-park-golf-course/?$ courses/henry-horton-state-park-golf-course.php [L]
RewriteRule ^courses/hermitage-golf-course/?$ courses/hermitage-golf-course.php [L]
RewriteRule ^courses/hillwood-country-club/?$ courses/hillwood-country-club.php [L]
RewriteRule ^courses/holston-hills-country-club/?$ courses/holston-hills-country-club.php [L]
RewriteRule ^courses/honky-tonk-national-golf-course/?$ courses/honky-tonk-national-golf-course.php [L]
RewriteRule ^courses/island-pointe-golf-club/?$ courses/island-pointe-golf-club.php [L]
RewriteRule ^courses/jackson-country-club/?$ courses/jackson-country-club.php [L]
RewriteRule ^courses/mccabe-golf-course/?$ courses/mccabe-golf-course.php [L]
RewriteRule ^courses/memphis-country-club/?$ courses/memphis-country-club.php [L]
RewriteRule ^courses/mirimichi-golf-course/?$ courses/mirimichi-golf-course.php [L]
RewriteRule ^courses/montgomery-bell-state-park-golf-course/?$ courses/montgomery-bell-state-park-golf-course.php [L]
RewriteRule ^courses/nashville-national-golf-links/?$ courses/nashville-national-golf-links.php [L]
RewriteRule ^courses/nashville-golf-athletic-club/?$ courses/nashville-golf-athletic-club.php [L]
RewriteRule ^courses/richland-country-club/?$ courses/richland-country-club.php [L]
RewriteRule ^courses/stones-river-country-club/?$ courses/stones-river-country-club.php [L]
RewriteRule ^courses/springhouse-golf-club/?$ courses/springhouse-golf-club.php [L]
RewriteRule ^courses/sweetens-cove-golf-club/?$ courses/sweetens-cove-golf-club.php [L]
RewriteRule ^courses/warriors-path-state-park-golf-course/?$ courses/warriors-path-state-park-golf-course.php [L]
RewriteRule ^courses/eagles-landing-golf-club/?$ courses/eagles-landing-golf-club.php [L]
RewriteRule ^courses/sevierville-golf-club/?$ courses/sevierville-golf-club.php [L]
RewriteRule ^courses/pine-oaks-golf-course/?$ courses/pine-oaks-golf-course.php [L]
RewriteRule ^courses/lambert-acres-golf-club/?$ courses/lambert-acres-golf-club.php [L]
RewriteRule ^courses/lake-tansi-golf-course/?$ courses/lake-tansi-golf-course.php [L]
RewriteRule ^courses/egwani-farms-golf-course/?$ courses/egwani-farms-golf-course.php [L]
RewriteRule ^courses/fall-creek-falls-state-park-golf-course/?$ courses/fall-creek-falls-state-park-golf-course.php [L]
RewriteRule ^courses/dead-horse-lake-golf-course/?$ courses/dead-horse-lake-golf-course.php [L]
RewriteRule ^courses/bear-trace-cumberland-mountain/?$ courses/bear-trace-cumberland-mountain.php [L]
RewriteRule ^courses/bear-trace-at-tims-ford/?$ courses/bear-trace-at-tims-ford.php [L]
RewriteRule ^courses/laurel-valley-country-club/?$ courses/laurel-valley-country-club.php [L]
RewriteRule ^courses/druid-hills-golf-club/?$ courses/druid-hills-golf-club.php [L]
RewriteRule ^courses/blackthorn-club/?$ courses/blackthorn-club.php [L]
RewriteRule ^courses/old-hickory-country-club/?$ courses/old-hickory-country-club.php [L]
RewriteRule ^courses/old-fort-golf-course/?$ courses/old-fort-golf-course.php [L]
RewriteRule ^courses/paris-landing-state-park-golf-course/?$ courses/paris-landing-state-park-golf-course.php [L]
RewriteRule ^courses/percy-warner-golf-course/?$ courses/percy-warner-golf-course.php [L]
RewriteRule ^courses/pickwick-landing-state-park/?$ courses/pickwick-landing-state-park.php [L]
RewriteRule ^courses/temple-hills-country-club/?$ courses/temple-hills-country-club.php [L]
RewriteRule ^courses/tanasi-golf-course/?$ courses/tanasi-golf-course.php [L]
RewriteRule ^courses/ted-rhodes-golf-course/?$ courses/ted-rhodes-golf-course.php [L]
RewriteRule ^courses/the-club-at-five-oaks/?$ courses/the-club-at-five-oaks.php [L]
RewriteRule ^courses/the-country-club/?$ courses/the-country-club.php [L]
RewriteRule ^courses/the-club-at-gettysvue/?$ courses/the-club-at-gettysvue.php [L]
RewriteRule ^courses/the-golf-club-of-tennessee/?$ courses/the-golf-club-of-tennessee.php [L]
RewriteRule ^courses/the-grove/?$ courses/the-grove.php [L]
RewriteRule ^courses/the-governors-club/?$ courses/the-governors-club.php [L]
RewriteRule ^courses/the-honors-course/?$ courses/the-honors-course.php [L]
RewriteRule ^courses/the-links-at-audubon/?$ courses/the-links-at-audubon.php [L]
RewriteRule ^courses/the-links-at-fox-meadows/?$ courses/the-links-at-fox-meadows.php [L]
RewriteRule ^courses/the-links-at-galloway/?$ courses/the-links-at-galloway.php [L]
RewriteRule ^courses/the-links-at-kahite/?$ courses/the-links-at-kahite.php [L]
RewriteRule ^courses/the-links-at-whitehaven/?$ courses/the-links-at-whitehaven.php [L]
RewriteRule ^courses/the-legacy-golf-course/?$ courses/the-legacy-golf-course.php [L]
RewriteRule ^courses/tennessee-grasslands-fairvue/?$ courses/tennessee-grasslands-fairvue.php [L]
RewriteRule ^courses/tennessee-grasslands-foxland/?$ courses/tennessee-grasslands-foxland.php [L]
RewriteRule ^courses/tennessee-national-golf-club/?$ courses/tennessee-national-golf-club.php [L]
RewriteRule ^courses/three-ridges-golf-course/?$ courses/three-ridges-golf-course.php [L]
RewriteRule ^courses/tpc-southwind/?$ courses/tpc-southwind.php [L]
RewriteRule ^courses/toqua-golf-course/?$ courses/toqua-golf-course.php [L]
RewriteRule ^courses/troubadour-golf-field-club/?$ courses/troubadour-golf-field-club.php [L]
RewriteRule ^courses/two-rivers-golf-course/?$ courses/two-rivers-golf-course.php [L]
RewriteRule ^courses/vanderbilt-legends-club/?$ courses/vanderbilt-legends-club.php [L]
RewriteRule ^courses/willow-creek-golf-club/?$ courses/willow-creek-golf-club.php [L]
RewriteRule ^courses/williams-creek-golf-course/?$ courses/williams-creek-golf-course.php [L]
RewriteRule ^courses/windriver-golf-club/?$ courses/windriver-golf-club.php [L]
RewriteRule ^courses/windtree-golf-course/?$ courses/windtree-golf-course.php [L]
RewriteRule ^courses/signal-mountain-golf-country-club/?$ courses/signal-mountain-golf-country-club.php [L]
RewriteRule ^courses/southern-hills-golf-country-club/?$ courses/southern-hills-golf-country-club.php [L]
RewriteRule ^courses/sparta-country-club/?$ courses/sparta-country-club.php [L]
RewriteRule ^courses/stonehenge-golf-club/?$ courses/stonehenge-golf-club.php [L]
RewriteRule ^courses/whittle-springs-golf-course/?$ courses/whittle-springs-golf-course.php [L]
RewriteRule ^courses/white-plains-golf-course/?$ courses/white-plains-golf-course.php [L]
RewriteRule ^courses/lookout-mountain-club/?$ courses/lookout-mountain-club.php [L]
RewriteRule ^courses/moccasin-bend-golf-course/?$ courses/moccasin-bend-golf-course.php [L]
RewriteRule ^courses/ross-creek-landing-golf-course/?$ courses/ross-creek-landing-golf-course.php [L]
RewriteRule ^courses/overton-park-9/?$ courses/overton-park-9.php [L]
RewriteRule ^courses/windyke-country-club/?$ courses/windyke-country-club.php [L]

# Handle news article pages (in subdirectory)
RewriteRule ^news/tour-championship-2025-atlanta-complete-tournament-recap-fleetwood-first-win/?$ news/tour-championship-2025-atlanta-complete-tournament-recap-fleetwood-first-win.php [L]
RewriteRule ^news/liv-golf-michigan-2025-team-championship-complete-tournament-recap/?$ news/liv-golf-michigan-2025-team-championship-complete-tournament-recap.php [L]
RewriteRule ^news/smith-narramore-capture-55th-tennessee-four-ball-championship-morristown/?$ news/smith-narramore-capture-55th-tennessee-four-ball-championship-morristown.php [L]
RewriteRule ^news/liv-golf-michigan-2025-championship-legion-xiii-playoff-victory/?$ news/liv-golf-michigan-2025-championship-legion-xiii-playoff-victory.php [L]
RewriteRule ^news/liv-golf-michigan-2025-semifinals-thriller/?$ news/liv-golf-michigan-2025-semifinals-thriller.php [L]
RewriteRule ^news/liv-golf-michigan-team-championship-2025-quarterfinals/?$ news/liv-golf-michigan-team-championship-2025-quarterfinals.php [L]
RewriteRule ^news/tour-championship-2025-final-round-fleetwood-historic-win/?$ news/tour-championship-2025-final-round-fleetwood-historic-win.php [L]
RewriteRule ^news/tour-championship-2025-round-3-cantlay-fleetwood-tied/?$ news/tour-championship-2025-round-3-cantlay-fleetwood-tied.php [L]
RewriteRule ^news/tour-championship-2025-round-2-fleetwood-henley-share-lead/?$ news/tour-championship-2025-round-2-fleetwood-henley-share-lead.php [L]
RewriteRule ^news/tour-championship-2025-first-round-henley-leads/?$ news/tour-championship-2025-first-round-henley-leads.php [L]
RewriteRule ^news/2025-tour-championship-atlanta-predictions/?$ news/2025-tour-championship-atlanta-predictions.php [L]
RewriteRule ^news/tennessee-four-ball-championship-2025-country-club-morristown/?$ news/tennessee-four-ball-championship-2025-country-club-morristown.php [L]
RewriteRule ^news/belmont-conner-brown-wins-tennessee-match-play-championship/?$ news/belmont-conner-brown-wins-tennessee-match-play-championship.php [L]
RewriteRule ^news/etsu-gavin-tiernan-amateur-championship-runner-up/?$ news/etsu-gavin-tiernan-amateur-championship-runner-up.php [L]
RewriteRule ^news/liv-golf-indianapolis-2025-complete-tournament-recap-entertainment/?$ news/liv-golf-indianapolis-2025-complete-tournament-recap-entertainment.php [L]
RewriteRule ^news/bmw-championship-2025-complete-tournament-recap-community-impact/?$ news/bmw-championship-2025-complete-tournament-recap-community-impact.php [L]
RewriteRule ^news/tennessee-herrington-historic-run-125th-us-amateur-runner-up/?$ news/tennessee-herrington-historic-run-125th-us-amateur-runner-up.php [L]
RewriteRule ^news/scheffler-delivers-stunning-comeback-wins-bmw-championship/?$ news/scheffler-delivers-stunning-comeback-wins-bmw-championship.php [L]
RewriteRule ^news/macintyre-weathers-moving-day-storm-maintains-bmw-championship-lead/?$ news/macintyre-weathers-moving-day-storm-maintains-bmw-championship-lead.php [L]
RewriteRule ^news/macintyre-extends-commanding-lead-scheffler-pursuit-bmw-championship/?$ news/macintyre-extends-commanding-lead-scheffler-pursuit-bmw-championship.php [L]
RewriteRule ^news/macintyre-explodes-for-62-leads-bmw-championship/?$ news/macintyre-explodes-for-62-leads-bmw-championship.php [L]
RewriteRule ^news/fedex-st-jude-championship-2025-complete-recap-community-impact/?$ news/fedex-st-jude-championship-2025-complete-recap-community-impact.php [L]
RewriteRule ^news/rose-captures-thrilling-playoff-victory-fleetwood-heartbreak/?$ news/rose-captures-thrilling-playoff-victory-fleetwood-heartbreak.php [L]
RewriteRule ^news/fleetwood-maintains-narrow-lead-scheffler-charges/?$ news/fleetwood-maintains-narrow-lead-scheffler-charges.php [L]
RewriteRule ^news/fleetwood-takes-command-weather-halts-play/?$ news/fleetwood-takes-command-weather-halts-play.php [L]
RewriteRule ^news/fedex-st-jude-first-round-bhatia-leads/?$ news/fedex-st-jude-first-round-bhatia-leads.php [L]
RewriteRule ^news/open-championship-2025-round-1-royal-portrush/?$ news/open-championship-2025-round-1-royal-portrush.php [L]
RewriteRule ^news/scheffler-extends-lead-open-championship-round-3/?$ news/scheffler-extends-lead-open-championship-round-3.php [L]
RewriteRule ^news/scheffler-seizes-control-open-championship-round-2/?$ news/scheffler-seizes-control-open-championship-round-2.php [L]
RewriteRule ^news/scheffler-wins-2025-british-open-final-round/?$ news/scheffler-wins-2025-british-open-final-round.php [L]

# Handle review article pages (in subdirectory)
RewriteRule ^reviews/top-5-golf-courses-near-memphis-tn/?$ reviews/top-5-golf-courses-near-memphis-tn.php [L]
RewriteRule ^reviews/top-5-golf-courses-near-knoxville-tn/?$ reviews/top-5-golf-courses-near-knoxville-tn.php [L]
RewriteRule ^reviews/top-5-golf-courses-tennessee/?$ reviews/top-5-golf-courses-tennessee.php [L]
RewriteRule ^reviews/top-5-golf-drivers-2025/?$ reviews/top-5-golf-drivers-2025.php [L]
RewriteRule ^reviews/top-5-golf-balls-2025/?$ reviews/top-5-golf-balls-2025.php [L]
RewriteRule ^reviews/top-10-putters-2025-amazon-guide/?$ reviews/top-10-putters-2025-amazon-guide.php [L]

# Handle auth pages (clean URLs without /auth/ prefix)
RewriteRule ^login/?$ auth/login.php [L]
RewriteRule ^register/?$ auth/register.php [L]
RewriteRule ^register-process/?$ auth/register-process.php [L]
RewriteRule ^registration-success/?$ auth/registration-success.php [L]
RewriteRule ^login-process/?$ auth/login-process.php [L]
RewriteRule ^logout/?$ auth/logout.php [L]
RewriteRule ^forgot-password/?$ auth/forgot-password.php [L]
RewriteRule ^forgot-password-process/?$ auth/forgot-password-process.php [L]
RewriteRule ^password-reset/?$ auth/password-reset.php [L]
RewriteRule ^password-reset-process/?$ auth/password-reset-process.php [L]
RewriteRule ^reset-password/?$ auth/reset-password.php [L]
RewriteRule ^reset-password-process/?$ auth/reset-password-process.php [L]
RewriteRule ^verify-email/?$ auth/verify-email.php [L]

# Handle user pages (clean URLs without /user/ prefix)
RewriteRule ^profile/?$ user/profile.php [L]
RewriteRule ^edit-profile/?$ user/edit-profile.php [L]
RewriteRule ^security-dashboard/?$ user/security-dashboard.php [L]

# Handle newsletter pages
RewriteRule ^newsletter-subscribe/?$ newsletter-subscribe.php [L]
RewriteRule ^newsletter-unsubscribe/?$ newsletter-unsubscribe.php [L]
RewriteRule ^newsletter-test/?$ newsletter-test.php [L]

# Handle admin pages
RewriteRule ^admin/login/?$ admin/login.php [L]
RewriteRule ^admin/logout/?$ admin/logout.php [L]
RewriteRule ^admin/dashboard/?$ admin/dashboard.php [L]
RewriteRule ^admin/users/?$ admin/users.php [L]
RewriteRule ^admin/security/?$ admin/security.php [L]
RewriteRule ^admin/logs/?$ admin/logs.php [L]
RewriteRule ^admin/settings/?$ admin/settings.php [L]
RewriteRule ^admin/cache/?$ admin/cache-manager.php [L]
RewriteRule ^admin/newsletter/?$ admin/newsletter-admin.php [L]
RewriteRule ^admin/create-admin/?$ admin/create-admin.php [L]
RewriteRule ^admin/change-password/?$ admin/change-password.php [L]
RewriteRule ^admin/set-new-password/?$ admin/set-new-password.php [L]
RewriteRule ^admin/run-all-migrations/?$ admin/run-all-migrations.php [L]
RewriteRule ^admin/test-security/?$ admin/test-security.php [L]
RewriteRule ^admin/performance-monitor/?$ admin/performance-monitor.php [L]
RewriteRule ^admin/seo-manager/?$ admin/seo-manager.php [L]
RewriteRule ^admin/contest-entries/?$ admin/contest-entries.php [L]
RewriteRule ^admin/contest-entry-details/?$ admin/contest-entry-details.php [L]
RewriteRule ^admin/update-contest-status/?$ admin/update-contest-status.php [L]
RewriteRule ^admin/cleanup-contest-entries/?$ admin/cleanup-contest-entries.php [L]
RewriteRule ^admin/delete-contest-entry/?$ admin/delete-contest-entry.php [L]
RewriteRule ^admin/delete-all-contest-entries/?$ admin/delete-all-contest-entries.php [L]

# SEO Routes
RewriteRule ^sitemap\.xml$ sitemap-generator.php [L]

# Handle API routes
RewriteRule ^api/?$ api/v1/index.php [L]
RewriteRule ^api/v1/?$ api/v1/index.php [L]
RewriteRule ^api/v1/courses/?$ api/v1/courses.php [L]
RewriteRule ^api/v1/courses/([0-9]+)/?$ api/v1/courses.php?id=$1 [L]
RewriteRule ^api/v1/auth/?$ api/v1/auth.php [L]
RewriteRule ^api/v1/user/?$ api/v1/user.php [L]
RewriteRule ^api/v1/newsletter/?$ api/v1/newsletter.php [L]

# General clean URL rewriting (internal)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^([^/]+)/?$ $1.php [L]

# Security headers
<IfModule mod_headers.c>
    # Prevent clickjacking (disabled to allow Google Maps)
    # Header always set X-Frame-Options "DENY"
    
    # Prevent MIME type sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # Enable XSS protection (legacy browsers)
    Header always set X-XSS-Protection "1; mode=block"
    
    # Referrer policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Permissions Policy (formerly Feature Policy)
    Header always set Permissions-Policy "camera=(), microphone=(), geolocation=(), payment=()"
    
    # Remove PHP version header
    Header always unset X-Powered-By
    
    # Content Security Policy (basic - adjust as needed)
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://api.mapbox.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://api.mapbox.com; img-src 'self' data: https: https://api.mapbox.com https://*.tiles.mapbox.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; connect-src 'self' https://www.google-analytics.com https://api.mapbox.com https://*.tiles.mapbox.com https://events.mapbox.com; worker-src 'self' blob:; frame-src 'self' https://maps.google.com https://www.google.com; object-src 'none'; base-uri 'self';"
    
    # HSTS - HTTP Strict Transport Security
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
</IfModule>

# Cache static assets
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/webp "access plus 1 month"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# Prevent PHP execution in upload directories
<Directory ~ "uploads">
    <Files ~ "\.php$">
        Order allow,deny
        Deny from all
    </Files>
</Directory>

# Block access to backup files
<FilesMatch "(\.(bak|backup|old|orig|original|tmp|temp|copy|save)|~)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protect against XSS attacks via file uploads
<FilesMatch "\.(html|htm|js|php|php3|php4|php5|phps|phtml|shtml)$">
    <IfModule mod_headers.c>
        Header set X-Content-Type-Options "nosniff"
    </IfModule>
</FilesMatch>

# Disable HTTP TRACE method
<IfModule mod_rewrite.c>
    RewriteCond %{REQUEST_METHOD} ^TRACE
    RewriteRule .* - [F]
</IfModule>

# Block common exploit attempts
<IfModule mod_rewrite.c>
    RewriteCond %{QUERY_STRING} base64_encode[^(]*\([^)]*\) [OR]
    RewriteCond %{QUERY_STRING} (<|%3C)([^s]*s)+cript.*(>|%3E) [NC,OR]
    RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
    RewriteRule .* - [F]
</IfModule>